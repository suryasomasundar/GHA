name: Run Vanilla TestNG Tests

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  test:
    runs-on: ubuntu-latest

    container:
      image: budtmo/docker-android:emulator_11.0
      options: --privileged --user root -v /github/workspace:/github/workspace

    steps:
      - name: Install Dependencies
        run: |
          apt-get update
          apt-get install -y wget unzip maven

      - name: Download and Extract Project
        run: |
          echo "üì• Downloading Project ZIP..."
          wget -O /github/workspace/gha.zip "https://github.com/suryasomasundar/GHA/releases/download/automation/gha.zip"
          
          echo "üìÇ Extracting ZIP..."
          unzip /github/workspace/gha.zip -d /github/workspace/
          
          echo "üìÇ Verifying Extracted Files..."
          ls -la /github/workspace/

      - name: Verify Project Structure
        run: |
          if [[ ! -f "/github/workspace/TestAppiumDemo/pom.xml" ]]; then
            echo "‚ùå pom.xml is missing! Exiting..."
            exit 1
          fi
          if [[ ! -f "/github/workspace/TestAppiumDemo/android-testng.xml" ]]; then
            echo "‚ùå android-testng.xml is missing! Exiting..."
            exit 1
          fi

      - name: Run TestNG Tests
        working-directory: /github/workspace/TestAppiumDemo
        run: mvn clean test -DsuiteXmlFile=android-testng.xml

      - name: Upload Test Results
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: test-results
          path: /github/workspace/TestAppiumDemo/target/surefire-reports
