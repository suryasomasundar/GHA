name: Run Vanilla TestNG Tests

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  test:
    runs-on: ubuntu-latest

    container:
      image: budtmo/docker-android:emulator_11.0
      options: --privileged --user root -v /github/workspace:/github/workspace

    steps:
      - name: Install Dependencies
        run: |
          apt-get update
          apt-get install -y git wget curl unzip maven

      - name: Checkout Repository
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
          submodules: recursive  # Ensures submodules are checked out

      - name: Fix Git Safe Directory Error
        run: git config --global --add safe.directory "$(pwd)"

      - name: Ensure TestAppiumDemo Exists
        run: |
          if [[ ! -d "/github/workspace/TestAppiumDemo" ]]; then
            echo "❌ TestAppiumDemo directory not found! Exiting..."
            exit 1
          fi

      - name: Verify Repository Structure
        run: |
          echo "Checking TestAppiumDemo directory:"
          ls -la /github/workspace/TestAppiumDemo
          if [[ ! -f "/github/workspace/TestAppiumDemo/pom.xml" ]]; then
            echo "❌ pom.xml is missing! Exiting..."
            exit 1
          fi

      - name: Run TestNG Tests
        working-directory: /github/workspace/TestAppiumDemo
        run: mvn clean test -DsuiteXmlFile=android-testng.xml
